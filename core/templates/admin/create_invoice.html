{% extends "admin/base_admin.html" %}
{% load static %}


{% block title %}Create Invoices â€“ Admin{% endblock %}

{% block extra_css %}
<style>
/* ------ CREATE INVOICE HEADER BANNER ----- */
.invoice-header-card {
    background-color: #e8f2f0 !important;
    width: 100%;
}

.invoice-header {
    font-family: serif;
    text-align: center;
    padding: 2rem 3rem;
    font-size: 2.5rem;
    font-weight: 400;
    color: black;
}

/* ------- MAIN FORM CARD -------*/
.invoice-container {
    width: 100%;
    max-width: 750px;
    margin: 50px auto 60px auto;
    background: #ffffff;
    padding: 40px 45px;
    border-radius: 16px;
    box-shadow: 0 8px 22px rgba(0,0,0,0.06);
    color: black;
    font-family: serif;
}

/*------- SECTION HEADINGS ------- */
.invoice-container h2 {
    margin-top: 40px;
    margin-bottom: 18px;
    color: black;
    font-weight: 100;
    font-size: 2rem;
    border-bottom: 1px solid #e4efec;
    padding-bottom: 6px;
}

/* -------- FORM ------ */
.form-group {
    margin-bottom: 20px;
    display: flex;
    flex-direction: column;
}

label {
    font-size: 1.5rem;
    color: black;
    margin-bottom: 6px;
}

input, textarea {
    width: 100%;
    padding: 12px 14px;
    border-radius: 10px;
    border: 1px solid #cfdedb;
    background: #f7fbfa;
    font-size: 1.3rem;
}

/* ------- INPUT FOR $ SYMBOL  -------*/
.input-with-symbol {
    position: relative;
}

.input-with-symbol input {
    padding-left: 24px; /* space for the $ symbol */
}

.currency-symbol {
    position: absolute;
    left: 10px;
    top: 50%;
    transform: translateY(-50%);
    font-weight: bold;
    color: #3c5c59;
    pointer-events: none; 
}

/* ------- LINE ITEMS ------- */
.item-row {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr 50px;
    gap: 12px;
    align-items: stretch;
    margin-bottom: 12px;
    border: 1px solid #cfdedb;
    border-radius: 12px;
    padding: 12px;
    background: #f7fbfa;
}

/* Form group inside item row */
.item-row .form-group {
    display: flex;
    flex-direction: column;
}

/* Remove button */
.item-row .remove-btn {
    align-self: end; /* align to bottom of input */
    background: #f3dada;
    color: #7a2e2e;
    border-radius: 12px;
    border: none;
    padding: 10px 0;
    width: 100%;
    font-weight: bold;
    cursor: pointer;
    height: 100%; 
    align: center;
}

.item-row .remove-btn:hover {
    background: #eac5c5;
}

/* Add item button */
.add-btn {
    background: #d9ebe7;
    margin-top: 15px;
    padding: 14px 24px;
    font-size: 1.1rem;
    border-radius: 30px;
    border: 1px solid #cfdedb;
    cursor: pointer;
}

.add-btn:hover {
    background: #c4ded8;
}

/* Submit button */
.submit-btn {
    background: #d9ebe7;
    color: black;
    width: 100%;
    margin-top: 30px;
    padding: 16px 0;
    font-size: 1.5rem;
    border-radius: 32px;
    font-weight: 500;
    border: 1px solid #849e99;
    cursor: pointer;
}
.submit-btn:hover { background: #5da39a; }

/* ------- TOTAL DISPLAY  -------*/
.total-box {
    text-align: right;
    margin-top: 25px;
    font-size: 1.5rem;
    font-weight: 600;
    color: #2f4f4f;
}

/* ------- MOBILE VIEW -------*/
@media (max-width: 768px) {
    .item-row {
        display: block; /* stack fields vertically */
        padding: 12px 16px;
        margin-bottom: 16px;
    }

    .item-row .form-group {
        margin-bottom: 12px;
    }

    .item-row .remove-btn {
        width: auto;
        display: block;
        margin-left: auto; 
    }

    .input-with-symbol {
        width: 100%;
    }

    .item-row .remove-btn {
        width: 100%;
        display: block;
        margin-left: 0;
        margin-top: 8px;
        padding: 12px 0;
        font-size: 1.2rem;
        border-radius: 12px; 
        text-align: center;
    }
}

</style>
{% endblock %}


{% block content %}

<!-- Page Header -->
<div class="invoice-header-card">
    <div class="invoice-header">
        Create Invoices
    </div>
</div>


<!-- Form container -->
<div class="invoice-container">
<!-- NEEDED IN HTML for POST - security reasons -->
<form method="POST">
{% csrf_token %}


<!-- Customer Info form section -->
<h2>Customer Information</h2>
<div class="form-group">
    <label>Full Name</label>
    <input type="text" name="full_name" required>
</div>

<div class="form-group">
    <label>Email Address</label>
    <input type="email" name="email" required>
</div>

<h2>Invoice Details</h2>
<div class="form-group">
    <label>Issue Date</label>
    <input type="date" name="issue_date" required>
</div>

<div class="form-group">
    <label>Due Date</label>
    <input type="date" name="due_date" required>
</div>

<div class="form-group">
    <label>Customer Notes</label>
    <textarea name="customer_notes"></textarea>
</div>


<!-- Line Items form section -->
<h2>Line Items</h2>
<div id="items">
    <!-- 1st Row (NO REMOVE BUTTON) -->
    <div class="item-row">
        <div class="form-group">
            <label>Description</label>
            <input type="text" name="description[]"  required>
        </div>
        <div class="form-group">
            <label>Quantity</label>
            <input type="number" name="quantity[]" min="1" value="1" oninput="calculateTotal()" required>
        </div>
        <div class="form-group price-group" >
            <label>Unit Price</label>
            <div class="input-with-symbol">
                <span class="currency-symbol">$</span>
                <input type="number" step="1" name="unit_price[]" oninput="calculateTotal()" required>
            </div>
        </div>
        <div></div>
    </div>
</div>

<!-- Add button -->
<button type="button" class="add-btn" onclick="addItem()">+ Add Item</button>

<!-- Total text - dynamic -->
<div class="total-box">
    Total: <span id="invoice-total">$0.00</span>
</div>

<!-- Submit button -->
<button type="submit" class="submit-btn">Create Invoice</button>
</form>
</div>


<script>
function formatCurrency(value) {
    return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(value);
}

// Calculate total of List Items
function calculateTotal() {
    var total = 0;
    const quantities = document.getElementsByName("quantity[]");
    const prices = document.getElementsByName("unit_price[]");

    for (var i = 0; i < quantities.length; i++) {
        const qty = parseFloat(quantities[i].value) || 0;
        const price = parseFloat(prices[i].value) || 0;
        total += qty * price;
    }

    document.getElementById("invoice-total").innerText = formatCurrency(total);
}

// To add an item to list - INCLUDES REMOVE BUTTON
function addItem() {
    const div = document.createElement("div");
    div.classList.add("item-row");
    div.innerHTML = `
        <div class="form-group">
            <label>Description</label>
            <input type="text" name="description[]"  required>
        </div>
        <div class="form-group">
            <label>Quantity</label>
            <input type="number" name="quantity[]" min="1" value="1" oninput="calculateTotal()" required>
        </div>
        <div class="form-group price-group">
            <label>Unit Price</label>
            <div class="input-with-symbol">
                <span class="currency-symbol">$</span>
                <input type="number" step="1" name="unit_price[]" oninput="calculateTotal()" required>
            </div>
        </div>
        
        <button type="button" class="remove-btn" onclick="removeItem(this)">X</button>
        
    `;
    document.getElementById("items").appendChild(div);
}

// To remove item list row
function removeItem(button) {
    button.parentElement.remove();
    calculateTotal();
}
</script>

{% endblock %}